# Ошибки и журнал

- [Детализация ошибок](#error-detail)
- [Обработка ошибок](#handling-errors)
- [Исключения HTTP](#http-exceptions)
- [Обработка 404](#handling-404-errors)
- [Журнал](#logging)

<a name="error-detail"></a>
## Детализация ошибок

По умолчанию в Laravel включена детализация ошибок, происходящих в вашем приложении. Это значит, что при их возникновении будет отображена страница с цепочкой вызовов и текстом ошибки. Вы можете отключить детализацию ошибок установкой настройки `debug` файла `app/config/app.php` в значение `false`. **Настоятельно рекомендуется отключать детализацю ошибок для производственных серверов.**

<a name="handling-errors"></a>
## Обработка ошибок

Файл `app/start/global.php` по умолчанию содержит обработчик любых исключений:

	App::error(function(Exception $exception)
	{
		Log::error($exception);
	});

Это самый примитивный обработчик. Однако вы можете зарегистрировать несколько обработчиков, если вам это нужно. Они будут вызываться в зависимости от типа `Exception`, указанного в их первом аргументе. Например, вы можете создать обработчик только для ошибок `RuntimeException`:

	App::error(function(RuntimeException $exception)
	{
		// Обработка исключения...
	});

Если обработчик возвращает ответ, он будет отправлен в браузер и никакие другие обработчики вызваны не будут:

	App::error(function(InvalidUserException $exception)
	{
		Log::error($exception);

		return 'Извини! Что-то не так с этим аккаунтом!';
	});

Вы можете зарегистрировать обработчик критических ошибок PHP методом `App::fatal`:

	App::fatal(function($exception)
	{
		//
	});

<a name="http-exceptions"></a>
## Исключения HTTP

Такие исключения могут возникнуть во время обработки запроса от клиента. Это может быть ошибка "Не найдено" (404), "Требуется авторизация" (401) или даже "Ошибка сервера" (500). Для того, чтобы отправить такой ответ, используйте следующее:

	App::abort(404, 'Страница не найдена.');

Первый параметр - код HTTP-ответа, а второй - сообщение, которое вы хотите показать вместе с ошибкой.

В случае с "Требуется авторизация" (401) сделайте аналогичный вызов:

	App::abort(401, 'Вы не вошли в систему.');

Эти исключения могут быть возбуждены на любом этапе обработки запроса.

<a name="handling-404-errors"></a>
## Обработка 404

Вы можете зарегистрировать обработчик для всех ошибок 404 ("Не найдено") в вашем приложении, что позволит вам отображать собственную страницу 404:

	App::missing(function($exception)
	{
		return Response::view('errors.missing', array(), 404);
	});

<a name="logging"></a>
## Журнал

Стандартный механизм журналирования представляет собой простую надстройку над мощной системой [Monolog](http://github.com/seldaek/monolog).По умолчанию Laravel настроен для создания одного файла журнала на один день и хранения их в `app/storage/logs`. Вы можете записывать в них таким образом:

	Log::info('Вот кое-какая полезная информация.');

	Log::warning('Что-то может идти не так.');

	Log::error('Что-то действительно идёт не так.');

Журнал предоставляет 7 уровней критичнорсти, определённые в [RFC 5424](http://tools.ietf.org/html/rfc5424) (в порядке возрастания - прим. пер.): **debug**, **info**, **notice**, **warning**, **error**, **critical** и **alert**.

В метод записи можно передать массив данных о текущем состоянии:

	Log::info('Log message', array('context' => 'Другая полезная информация.'));

Monolog имеет множество других методов, которые вам могут пригодиться. Если нужно, вы можете получить экземпляр его класса:

	$monolog = Log::getMonolog();

Вы также можете зарегистрировать обработчик события для отслеживания всех новых сообщений.

**Отслеживание новых сообщений в журнале:**

	Log::listen(function($level, $message, $context)
	{
		//
	});
